<html>
	<head>
		<title>Insights Client Egg Hatcher</title>
		<style>
			body {
				width: 60%;
				margin-left: 20%;
				margin-right: 20%;
			}
			h1 {
				text-align: center;
			}
			.section {
				width:40%;
				text-align: right;
				display: inline-block;
				margin: auto;
				vertical-align: top
			}
			select {
				margin-bottom: 10px;
			}
		</style>
	</head>
	<body>
		<h1>Insights Client<br>ðŸ¥š<br>Egg Hatcher</h1>
		<div class='section'>
			<h2>Select forked repo (dev):</h2>
			<select id='forks' onchange='computeForkFilename()'></select>
			<div>
				<form method='get' id='forkForm'>
					<button type='submit' id='forkEggDL'>Select</button>
				</form>
			</div>
		</div>
		<div class='section'>
			<h2>Get by tag (released):</h2>
			<select id='tags' onchange='computeTagFilename()'></select>
			<div>
				<form method='get' id='tagForm'>
					<button type='submit' id='tagEggDL'>Get .egg</button>
				</form>
				<!--<form method='get' id='tagAscForm'>
					<button type='submit' id='tagAscDL'>Get .asc</button>
				</form> -->
			</div>
			<h2>Build from branch (dev):</h2>
			<select id='branches' onchange='computeBranchFilename()'></select>
			<div>
			<form method='get' id='branchForm'>
				<button type='submit' id='branchEggDL'>Get .egg</button>
			</form>
			</div>
		</div>
	</body>
	<script>
		var tagSelect = document.getElementById('tags');
		var branchSelect = document.getElementById('branches');
		var tagButton1 = document.getElementById('tagEggDL');
		var branchButton = document.getElementById('branchEggDL');
		var forkSelect = document.getElementById('forks');
		var forkButton = document.getElementById('forkEggDL')
		tagButton1.disabled = true;
		branchButton.disabled = true;
		forkButton.disabled = true;

		function computeTagFilename() {
			var selectedTag = tagSelect.options[tagSelect.selectedIndex].value;
			document.getElementById('tagForm').action = '/tag/' + selectedTag;
		}

		function computeForkFilename(){
			var selectedFork = forkSelect.options[forkSelect.selectedIndex].value;
			document.getElementById('forkForm').action = '/repo/' + selectedFork;

		}

		function computeBranchFilename() {
			var selectedBranch = branchSelect.options[branchSelect.selectedIndex].value;
			document.getElementById('branchForm').action = '/branch/' + selectedBranch;
		}

		function init() {
			fetch('/fork')
			.then(function(res){
				return res.json();
			})
			.then(function(jso){
				for (var i in jso){
					forkSelect.options[forkSelect.options.length] = new Option(jso[i]['name'])
				}
				// set upstream as default
				for (var i in forkSelect.options){
					if (forkSelect.options[i].value === 'RedHatInsights'){
						forkSelect.selectedIndex = i;
					}
				}
				computeForkFilename();
				forkButton.disabled = false;
			})
			fetch('/tag')
			.then(function(res) {
				return res.json();
			})
			.then(function(jso){
				for (var i in jso) {
					tagSelect.options[tagSelect.options.length] = new Option(jso[i]['name'], jso[i]['fullTag'])
				}
				computeTagFilename();
				tagButton1.disabled = false;
			})
			fetch('/branch')
			.then(function(res) {
				return res.json();
			})
			.then(function(jso){
				for (var i in jso) {
					branchSelect.options[branchSelect.options.length] = new Option(jso[i]['name'], jso[i]['name'])
				}
				// set master as default
				for (var i in branchSelect.options) {
					if (branchSelect.options[i].value === 'master') {
						branchSelect.selectedIndex = i;
					}
				}
				computeBranchFilename();
				branchButton.disabled = false;
			})
		}
		init();
	</script>
</html>